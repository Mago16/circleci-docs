---

contentTags:
  platform:
  - Cloud
  - Server v4.x
  - Server v3.x
---
= Create an orb
:page-layout: classic-docs
:page-liquid:
:page-description: Tutorial showing how to create an orb using the orb development kit.
:icons: font
:toc: macro

:toc-title:

This tutorial guides you through creating a new orb using the orb development kit. The starting point is creating a new repository on link:https://github.com[GitHub.com].

Following this tutorial you will:

* Create a GitHub repo for your orb.
* Add templated orb config, based on your requirements.
* Set up a CI/CD pipeline for orb development and put restrictions on who can contribute towards the development of your orb.

At the end of the tutorial you will be ready to configure your orb.

These steps are also outlined in the following video.

.Create and initialize an orb
video::5ta4RUwqOBI[youtube]

[#prerequisites]
== 前提条件

* A GitHub account connected to your CircleCI account. See the link:/docs/first-steps/[Sign up and try] page for steps to get set up.
* link:/docs/local-cli/#installation[Set up the CircleCI CLI] on your local machine with a link:https://app.circleci.com/settings/user/tokens[personal access token]. 最新バージョンの CircleCI CLI を使用していることを確認してください。 You must be using version `v0.1.17087` or later.
+
```shell
$ circleci update

$ circleci version
```
* link:/docs/orb-author-intro/#register-a-namespace[Register a namespace] for your GitHub organization. Ensure the organization on GitHub is the owner for the CircleCI namespace for which you are developing your orb (this will be automatically configured correctly if you are using your own personal organization and namespace).

[#create-your-orb]
== Orb の作成

[#create-a-new-repo]
=== 1.  Create a new repo

Create a new, empty, link:https://github.com/new[GitHub repository]. The name of your repository is not critical, but something similar to "myProject-orb" is recommended.

NOTE: Ensure that the repository is completely empty. "README.md を追加する"、"ライセンスを選ぶ" といったオプションのチェックはすべて外してください。

image::{{site.baseurl}}/assets/img/docs/new_orb_repo_gh.png[New GitHub Repo]

Once complete, you should see the generated git URL. Note it down, you will need it in step 4. URL は SSH か HTTPS を選択できます。 どちらを選択しても認証を行えます。

image::{{site.baseurl}}/assets/img/docs/github_new_quick_setup.png[Orb Registry]

CAUTION: It is not necessary to pull down the orb repository. This will be completed when you run `orb init` in the next step. Pulling the repository before this will cause issues.

=== 2.  Orb を初期化します。

Open a terminal and initialize your new orb project using the `orb init` CLI command as shown below. The `circleci orb init` command is called, followed by a path to create and initialize for your orb project. このディレクトリと Git のプロジェクト リポジトリには、同じ名前を使用することをお勧めします。

CAUTION: If you are using CircleCI server, you should ensure the `--private` flag is used here to keep your orbs private within your installation.

WARNING: Once an orb is initialized, it **cannot be switched from public to private or vice versa**. Please make sure to add the `--private` flag if you intend to create a private orb.

* To initialize a link:/docs/orb-intro/#public-orbs[public] orb:
+
```shell
circleci orb init </path/to/myProject-orb>
```
* To initialize a link:/docs/orb-intro/#private-orbs[private] orb:
+
```shell
circleci orb init </path/to/myProject-orb> --private
```

=== 3.  Choose the fully automated orb setup option

```shell
? Would you like to perform an automated setup of this orb?:
   ▸  Yes, walk me through the process.
      No, I will handle everything myself.
```

When choosing the fully automated option, the link:https://github.com/CircleCI-Public/Orb-Template[orb template] is downloaded and automatically modified with your customized settings. プロジェクトは CircleCI でフォローされ、自動化された CI/CD パイプラインが含まれます。

For more information on the included CI/CD pipeline, see the link:/docs/creating-orbs/[Orb publishing process] page.

NOTE: If you would simply like a convenient way of downloading the link:https://github.com/CircleCI-Public/Orb-Template[orb template] you can opt to handle everything yourself. When choosing the manual option, see link:/docs/orb-author-validate-publish/[Manual orb authoring process] for instructions on how to author and publish your orb.

=== 4. Follow the prompts to set up your orb

In the background, the `orb init` command copies and customizes the link:https://github.com/CircleCI-Public/Orb-Template[orb template] based on your inputs. There are detailed `README.md` files within each directory that contain helpful information specific to the contents of each directory. 手順 1 で取得したリモート Git リポジトリ の URL も、入力が求められます。

The link:https://github.com/CircleCI-Public/Orb-Template[orb template] contains a full CI/CD pipeline (described in link:/docs/creating-orbs/[orb publishing process]), which automatically link:/docs/orb-concepts/#orb-packing[packs], link:/docs/testing-orbs/[tests], and link:/docs/creating-orbs/[publishes] your orb.

In the setup process you will be asked if you would like to save your [Personal API Token]({{site.baseurl}}/managing-api-tokens/) into an `orb-publishing` [context]({{site.baseurl}}/contexts/). Orb の開発版と安定版をパブリッシュするためには、このトークンを保存しておくことが必要です。 これまでに Orb を作成したことがある場合は、コンテキストが既に存在するためこの手順はスキップできます。

=== 5. Restrict who can trigger jobs for the orb

Use link:/docs/contexts/#restrict-a-context-to-a-security-group-or-groups[security groups] to limit access to users that are allowed to trigger jobs. Only these users will have access to the private link:/docs/managing-api-tokens/[personal API token].

link:/docs/contexts/#restricting-a-context[Contexts] can be located by navigating to **Organization Settings > Contexts** in the web app. After creating your orb, you will have a new context called `orb-publishing`. Click into `orb-publishing` and add a **Security Group**.

.Secure contexts
video::ImPE969yv08[youtube]

=== 6. Push changes to Github

During the setup process, the `orb init` command prepares your automated orb development pipeline. The modified template code produced by the CLI must be pushed to the repository before the CLI can continue and automatically follow your project on CircleCI.

これを実行するよう要求されたら、別のターミナルから以下のコマンドを、「default-branch」を実際のデフォルトブランチの名前に置き換えて実行します。

```shell
git push origin <default-branch>
```

完了したら、元のターミナルに戻って、変更がプッシュされたことを確認します。

=== 7. セットアップを完了します。

変更がプッシュされたら、ターミナルに戻り、セットアッププロセスを続けます。 CLI が CircleCI のプロジェクトを自動的にフォローし、同じコードで Orb をビルドしテストするパイプラインのトリガーを試みます。

CircleCI 上でプロジェクトのビルドへのリンクが表示され、全パイプラインを見ることができます。 You should also see the CLI has automatically migrated you into a new development branch, named `alpha`. You can use any branch naming you would like, you do not need to exclusively develop on `alpha`.

=== 8. ダイナミックコンフィグを有効にします。

Using the orb development kit makes use of link:/docs/dynamic-config/[Dynamic configuration], you will need to enable this feature. 最初のパイプラインでは「この機能は有効になっていません。」というエラーメッセージを受け取ります。

Following the link:/docs/dynamic-config/#getting-started-with-dynamic-config-in-circleci[Getting started with dynamic config in CircleCI] guide, open the **Project Settings** page for your orb on CircleCI, navigate to the **Advanced** tab, and click on the **Enable dynamic config using setup workflows** button.

有効化されると、その後のプロジェクトへのすべてのコミットは全パイプラインを介して実行され、Orb を実行します。 You could manually re-run the pipeline at this point, but since you are only working with sample code at this moment, it is not necessary.

=== 9. Orb を作成します。

From a non-default branch (you will be moved to the `alpha` branch automatically at setup), begin modifying the sample orb code to fit your requirements. On each _push_, your orb will be automatically built and tested. More information on developing your orb can be found on the link:/docs/orb-author/#writing-your-orb[Orb authoring process] page.

Be sure to view the link:https://github.com/CircleCI-Public/Orb-Template/blob/main/.circleci/test-deploy.yml[.circleci/test-deploy] file to view how your orb components are being tested, and modify your tests as you change your orb. Learn more about testing your orb on the link:/docs/testing-orbs/[Orb testing methodologies] page.

When you are ready to deploy the first production version of your orb, find information on deploying changes on the link:/docs/creating-orbs/[Orb publishing process] page.

.Build and test an orb
video::kTeRJrwxShI[youtube]

[#next-steps]
== 次のステップ