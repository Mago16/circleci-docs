---

layout: classic-docs
contentTags:
  platform:
  - Cloud
---
= Dynamic Configuration
:description: セットアップワークフローによるダイナミックコンフィグの使用方法に関する開発者向けページ
:page-layout: classic-docs
:page-liquid:
:icons: font
:toc: macro

:toc-title:

Instead of manually creating an individual CircleCI configuration per project, you might prefer in some cases to generate these configurations dynamically, depending on specific xref:pipeline-variables#[Pipeline values] or file paths.

CircleCI のダイナミックコンフィグ機能により、以下が可能となります。

- 条件付きでワークフローやコマンドを実行する。
- パイプライン パラメーターの値を渡す/ 別の設定ファイルを生成する。
- Trigger separate `config.yml` configurations, which exist outside the default parent `.circleci/` directory.

チームでのコードの格納に、複数のリポジトリではなくモノレポ (単一のリポジトリ) を使用している場合には特に、条件付きの自動生成が役立ちます。

例えば、リポジトリで変更されたファイルまたはサブディレクトリに基づいて、ダイナミックコンフィグを使用し、特定のワークフローをトリガーすることが考えられます。 そうしなければ、ちょっとした更新を加えるだけだとしても、すべてのマイクロサービスやサブプロジェクトでビルド、テスト、デプロイの一連のプロセスを毎回行うことになります。 This scenario is also referred to as _path filtering_.

ダイナミックコンフィグを使用するもう 1 つのシナリオは、プロジェクトが複数のモジュールから構成され、それぞれのモジュールが別のジョブを要求する場合です。 These jobs could be stored in multiple files as _fragments_ of a configuration. Instead of using one full `.circleci/config.yml` file, you could use dynamic configuration to combine these individual fragments into a full configuration when a pipeline is triggered. This scenario can also be referred to as _config splitting_.

[#getting-started-with-dynamic-config-in-circleci]
== CircleCI のダイナミックコンフィグの入門ガイド

To get started with Dynamic configuration in CircleCI:

. In the *Projects* dashboard from the CircleCI web application, select your project.
. Click the *Project Settings* button in the upper-right corner.
. On the left-hand panel, select *Advanced*.
. Scroll to the *Enable dynamic config using setup workflows* setting, and toggle it to the "on" position, as shown below:
image:{{site.baseurl}}/assets/img/docs/dynamic-config-enable.png[Enable dynamic config in the UI]
. While the steps above will make the feature available, your static `config.yml` will continue to work as normal. This feature will *not* be used until you add the `setup` key with a value of `true` to that `config.yml`.
Adding the key `setup: true` to the top level of your parent configuration file (in the `.circleci/` directory) will designate that `config.yml` as a setup configuration.
. At the end of the `setup` workflow, a `continue` job from the link:https://circleci.com/developer/orbs/orb/circleci/continuation[`continuation` orb] must be called. This does _not_ apply if you want to conditionally execute workflows or steps based on *updates to specified files* ("path filtering"), as described in the xref:using-dynamic-configuration#[Using dynamic configuration] how-to guide.

[#how-dynamic-config-works]
== ダイナミックコンフィグが機能するしくみ

CircleCI のダイナミックコンフィグ機能では、セットアップワークフローを使用します。 A _setup workflow_ can contain jobs that compute pipeline parameters, which can then be passed into an additional configuration that potentially exists in other directories. セットアップ ワークフローはまた、既存のスクリプトを使って新しい設定ファイルを生成することもできます。 いずれの場合でも、セットアップワークフローは、目的の次の設定ファイルまでパイプラインを続行します。

Behind the scenes, the _continuation_ configuration is implemented as a call to a public _pipeline continuation_ API. This API accepts a _continuation key_, which is a secret, unique-per-pipeline key that is automatically injected into the environment of jobs executed as part of the initial setup workflow. API はまた、設定ファイル文字列と一連のパイプライン パラメーターも受け入れます。

次の内容に注意してください。

- The setup phase requires `version: 2.1` or higher.
- パイプラインは一回のみ続行できます (つまり、別のセットアップ設定では、パイプラインは続行できません)。
- パイプラインは、作成して 6 時間以内であれば続行できます。
- セットアップ設定には、1 つのワークフローのみを含めることができます。
- 続行時間に送信されたパイプラインパラメーターは、トリガー (セットアップ) 時に送信されたパイプラインパラメーターとオーバーラップすることはできません。
- セットアップ設定で宣言されたパイプラインパラメーターは、continuation 設定でも宣言される必要があります。 このパラメーターは、続行時に使用することができます。

For a basic example on how to use setup workflows for dynamic configuration generation, see the xref:using-dynamic-configuration#[Using dynamic configuration] how-to guide.

[#dynamic-config-faqs]
== FAQ

include::../_includes/snippets/faq/dynamic-configuration-faq-snip.adoc[]

[#what-to-read-next]
== 次のステップ

- A how-to guide for xref:using-dynamic-configuration#[Using dynamic configuration]
- The link:https://circleci.com/developer/orbs/orb/circleci/continuation[`continuation` orb]
- The link:https://circleci.com/docs/api/v2/#operation/continuePipeline[`continuePipeline` API call]
- Take the link:https://academy.circleci.com/dynamic-config?access_code=public-2021[dynamic configuration course] with CircleCI Academy to learn more.